{% extends "base.html"%}
{% load static %}

{% block content %}
<h1 class="tipoLetra text-success text-center" style="margin-top: 100px;"> <span class="text-dark">¡Bienvenido <span id="username">{{user.username }}</span> a Te Lo
    Vendo!</span>
</h1>
<hr>
<div class="container-fluid px-5">
  <div class="row">
    <div class="col-2"style="margin-top: 3%;">
      <!-- inicio narbar -->
      <ul class="nav flex-column bg-light" style="width: 25rem;">
        <li class="nav-item" style="background-color: rgb(218, 238, 245);">
          <a id="selected" class="nav-link disabled" href="">Lista de pedidos</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" data-toggle="modal" data-target="#exampleModal" style="cursor: pointer;">Añadir pedido</a>
        </li>
      </ul>
      <!-- fin narbar -->
    </div>
    <div class="col-10">
      <div class="row">
        <h2 class="container">LISTA DE PEDIDOS</h1>
      </div>
      <div class="row">
        <!-- inicio tarjeta -->
        {% for pedido in pedidos %}
        {% if pedido.idcliente == user or user.is_staff %}
        {% if pedido.estado != 'Cancelado' %}
        <div class="card container" style="margin-bottom:20px;">
          <ul class="list-group list-group-flush m-2">
            <li class="list-group-item m-2">
              <div class="row">
                <div class="col-2 mt-3">
                  <span><b>{{pedido.estado}}</b></span>
                </div>
                <div class="col-6 border-right" style="text-align: end;">
                  <small>Pedido efectuado el: {{ pedido.fecha_pedido }}</small>
                  <br>
                  <small>Nº de pedido: <span id="idpedido">{{pedido.id }}</span><button class="btn btn-link btn-sm" id="copyButton"
                      onclick="copyToClipboard('{{pedido.id}}')">Copiar</button></small>
                </div>
                <div class="col-4" style="text-align: center;">

                  <a href="{% url 'detalle_pedido' pedido.id %}">
                    <h5 class="mt-3 text-decoration-none" style="font-family: 'Bozon Regular';">Ver Detalles del pedido >
                    </h5>
                  </a>

                </div>
              </div>
            </li>
            <li class="list-group-item">
              <div class="row">
                <div class="col-2">
                  <figure class="figure">
                    <img src="{{pedido.detallepedido_set.last.idproducto.imag.url}}" class="figure-img img-fluid rounded" alt="...">
                  </figure>
                </div>
                <div class="col-4">
                  <br>
                  {% if pedido.pedido_staff %}<p><b>Pedido realizado desde area de Ventas de TeLoVendo</b></p>{% endif %}
                  <p>Usuario: {{ pedido.idcliente.first_name }} {{ pedido.idcliente.last_name }}</p>
                  <p>Productos:{% for pedi in pedido.detallepedido_set.all %} {{pedi.idproducto.nombre}}({{pedi.cantidad}}){%endfor%}</p>
                  <!--<p>Cantidad de Empaques: {{ pedido.detallepedido_set.all|length}} un.</p> -->
                  <p>Precio: ${{ pedido.precio_total }}</p>
                  <p>Direccion: {{ pedido.idcliente.direccion }}</p>
                </div>
                <div class="col-6">
                  <div class="container">
                  <br><br><p>
                    <button type="button" class="btn btn-secondary btn-sm btn-block disabled rounded-pill">Escribir un comentario</button>
                  </p>
                  <p>
                    <a type="button" class="btn btn-outline-danger btn-sm btn-block {% if pedido.estado == 'En Despacho' or pedido.estado == 'Entregado' or pedido.estado == 'Cancelado' %} disabled {% endif %} rounded-pill" href="{% url 'cancelar_pedido' pedido.id  %}">Cancelar pedido</a>    
                  </p>
                </div>
                </div>
              </div>
            </li>
          </ul>
          <br>
        </div>
        {% endif %}
        {% endif %}
        {% empty %}
        <h3 class="text-center">Actualmente no hay pedidos para mostrar.</h3>
        
      {% endfor %} 
      </div>
      <!-- fin tarjeta -->
    </div>
  </div>
</div>
</div>

{%block modal%}
{% endblock %}

{% endblock %}